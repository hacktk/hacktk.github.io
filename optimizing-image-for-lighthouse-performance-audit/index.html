<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Lighthouse の Performance audits の対応方法を調べた（画像関連のみ） | hacktk blog</title><link rel=icon href=https://hacktk.net/images/favicon.ico><link rel=canonical href=https://hacktk.net/optimizing-image-for-lighthouse-performance-audit/><link rel=alternate href=https://hacktk.net/index.xml type=application/rss+xml title="hacktk blog"><meta name=description content="Lighthouse の Performance audits で画像関連がよく指摘され、都度調べているのでメモしておく。"><meta property="og:title" content="Lighthouse の Performance audits の対応方法を調べた（画像関連のみ）"><meta property="og:description" content="Lighthouse の Performance audits で画像関連がよく指摘され、都度調べているのでメモしておく。"><meta property="og:type" content="article"><meta property="og:url" content="https://hacktk.net/optimizing-image-for-lighthouse-performance-audit/"><meta property="og:image" content="https://hacktk.net/images/og.png"><meta property="article:published_time" content="2020-12-12T15:00:00+09:00"><meta property="article:modified_time" content="2020-12-12T15:00:00+09:00"><meta name=twitter:title content="Lighthouse の Performance audits の対応方法を調べた（画像関連のみ）"><meta name=twitter:description content="Lighthouse の Performance audits で画像関連がよく指摘され、都度調べているのでメモしておく。"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://hacktk.net/images/og.png"><style>pre,textarea{overflow:auto}[hidden],audio:not([controls]),template{display:none}details,main,summary{display:block}input[type=number]{width:auto}input[type=search]{-webkit-appearance:textfield}input[type=search]::-webkit-search-cancel-button,input[type=search]::-webkit-search-decoration{-webkit-appearance:none}progress{display:inline-block}small{font-size:75%}textarea{resize:vertical}[unselectable]{-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}*,::after,::before{box-sizing:inherit;border-style:solid;border-width:0}*{font-size:inherit;line-height:inherit;margin:0;padding:0}::after,::before{text-decoration:inherit;vertical-align:inherit}:root{-ms-overflow-style:-ms-autohiding-scrollbar;overflow-y:scroll;-webkit-text-size-adjust:100%;-ms-text-size-adjust:100%;text-size-adjust:100%;box-sizing:border-box;cursor:auto;text-rendering:optimizeLegibility}audio,canvas,iframe,img,svg,video{vertical-align:middle}button,input,select,textarea{background-color:transparent;color:inherit;font-family:inherit;font-style:inherit;font-weight:inherit;min-height:1.5em}code,kbd,pre,samp{font-family:monospace,monospace}nav ol,nav ul{list-style:none}select{-moz-appearance:none;-webkit-appearance:none}select::-ms-expand{display:none}select::-ms-value{color:currentColor}table{border-collapse:collapse;border-spacing:0}::-moz-selection{background-color:#b3d4fc;text-shadow:none}::selection{background-color:#b3d4fc;text-shadow:none}@media screen{[hidden~=screen]{display:inherit}[hidden~=screen]:not(:active):not(:focus):not(:target){clip:rect(0 0 0 0)!important;position:absolute!important}}*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;*behavior:url(/scripts/boxsizing.htc)}.container{max-width:800px;margin:0 auto}.container:after,.row:after,.col:after,.clr:after,.group:after{content:"";display:table;clear:both}.row{padding-bottom:0}.col{display:block;float:left;width:100%}@media(min-width:768px){.gutters .col{margin-left:2%}.gutters .col:first-child{margin-left:0}}@media(min-width:768px){.span_1{width:8.33333333333%}.span_2{width:16.6666666667%}.span_3{width:25%}.span_4{width:33.3333333333%}.span_5{width:41.6666666667%}.span_6{width:50%}.span_7{width:58.3333333333%}.span_8{width:66.6666666667%}.span_9{width:75%}.span_10{width:83.3333333333%}.span_11{width:91.6666666667%}.span_12{width:100%}.gutters .span_1{width:6.5%}.gutters .span_2{width:15%}.gutters .span_3{width:23.5%}.gutters .span_4{width:32%}.gutters .span_5{width:40.5%}.gutters .span_6{width:49%}.gutters .span_7{width:57.5%}.gutters .span_8{width:66%}.gutters .span_9{width:74.5%}.gutters .span_10{width:83%}.gutters .span_11{width:91.5%}.gutters .span_12{width:100%}}body{font-family:hiragino kaku gothic pron,Meiryo,sans-serif;font-size:.9rem;line-height:1.4rem;letter-spacing:.03rem;overflow-wrap:break-word;word-wrap:break-word}h1{font-size:1.2rem}h2{font-size:1.1rem}h3,h4,h5,h6{font-size:1rem}ul,ol{margin-left:1.8rem}li{margin:.4rem 0}pre,code{font-family:consolas,courier new,monospace;background-color:#eee;border-radius:.2rem;padding:.2rem .4rem;font-size:.9rem}pre{padding:1rem 1.4rem;max-width:100%;overflow:auto}pre code{background:inherit;font-size:inherit;color:inherit;border:0;padding:0;margin:0}blockquote{margin:2rem 0;padding:.6rem 1.2rem;border-left:4px solid #757575;font-style:italic;background-color:#eee}img{max-width:100%;height:auto;border:0;vertical-align:middle}header{padding:1.2rem 0;margin-bottom:1.2rem}article{margin-bottom:3rem}footer{margin:2rem 0;padding:.6rem 0;border-top:2px solid #757575}footer img{border-radius:2rem;-webkit-border-radius:2rem;-moz-border-radius:2rem;margin-bottom:.6rem}.article-header{border-left:4px solid #29abe2;margin:.6rem 0 1.5rem;padding:.3rem 0 .3rem .6rem}article h2{border-bottom:2px solid #757575;margin:3rem 0 1.5rem;padding-bottom:.6rem}article h3,article h4,article h5,article h6{margin:2rem 0 1.5rem}article p{margin:1.2rem 0}article img{display:block;margin:0 auto;text-align:center}.container{padding:0 1rem}.gray{color:#757575}.summary{padding-bottom:1.2rem;margin-bottom:1.2rem}.meta{font-size:.8rem}.back-to-top{margin-top:1.2rem}</style></head><body><div class=container><header><div class="row gutters"><div class=col><h1><a href=https://hacktk.net/>hacktk blog</a></h1></div></div></header><main><div class=article-header><h1>Lighthouse の Performance audits の対応方法を調べた（画像関連のみ）</h1><div class="meta gray">2020-12-12</div></div><article><h2 id=前提>前提</h2><ul><li>Lighthouse の <a href=https://web.dev/lighthouse-performance/ target=_blank rel=noopener>Performance audits</a>
の中で、画像関連のものの意味や対応方法を調べた<ul><li><a href=https://web.dev/optimize-cls/#modern-best-practice target=_blank rel=noopener>Optimize Cumulative Layout Shift の Modern best practice</a>
は Lighthouse でチェックされるが、今回は上記のリストのみを調査対象とした</li></ul></li><li>各ブラウザの対応状況などは、2020 年 12 月時点のもの</li><li>ちなみに Lighthouse のスコア計算に使われるのは Metrics のみである<ul><li><a href=https://web.dev/performance-scoring/ target=_blank rel=noopener>https://web.dev/performance-scoring/</a></li><li>ただ Opportunities や Diagnostics を改善すると結果的に Metrics も改善されるので、対応するのが良い</li></ul></li></ul><h2 id=対応>対応</h2><h3 id=次世代フォーマットを使う>次世代フォーマットを使う</h3><ul><li><a href=https://web.dev/uses-webp-images/ target=_blank rel=noopener>https://web.dev/uses-webp-images/</a></li><li>次世代フォーマットは画像の圧縮率が高い</li><li>JPEG や PNG ではなく Webp などにする</li><li>Webp は 2020 年 9 月に Safari, iOS Safari が対応したので、現在の非対応は実質 Internet Explorer 11 のみ<ul><li><a href="https://caniuse.com/#feat=webp" target=_blank rel=noopener>https://caniuse.com/#feat=webp</a></li><li>※ ただし Safari は macOS 11 Big Sur 以降が必要</li></ul></li></ul><h3 id=適切な大きさにする>適切な大きさにする</h3><ul><li><a href=https://web.dev/uses-responsive-images/ target=_blank rel=noopener>https://web.dev/uses-responsive-images/</a></li><li>実際のレンダリングサイズが、画像のサイズより一定以上小さい場合に指摘される<ul><li>例：100×100 の画像を 50×50 で表示している場合</li></ul></li><li>複数の画像を用意する、画像特化の CDN を使って複数のサイズを生成する、SVG を使うなどの対応方法がある</li></ul><h3 id=画像の品質を最適化する>画像の品質を最適化する</h3><ul><li><a href=https://web.dev/uses-optimized-images/ target=_blank rel=noopener>https://web.dev/uses-optimized-images/</a></li><li>JPEG や BMP には 1〜100 の圧縮レベルがあるが、85 を最適としている<ul><li>圧縮レベル 85 にしたものと元のものを比較し、4kib 以上の差がある場合に指摘される</li></ul></li><li><a href=https://squoosh.app/ target=_blank rel=noopener>Squoosh</a>
などを使い、品質を 85 にする</li></ul><h3 id=ファーストビューに入っていない画像は読み込みを遅延させる>ファーストビューに入っていない画像は読み込みを遅延させる</h3><ul><li><a href=https://web.dev/offscreen-images/ target=_blank rel=noopener>https://web.dev/offscreen-images/</a></li><li>いわゆる Lazy load で対応する</li><li>現在は JavaScript でやっているサイトが多いが、img タグの <code>loading="lazy"</code> でもできる<ul><li><a href=https://web.dev/browser-level-image-lazy-loading/ target=_blank rel=noopener>https://web.dev/browser-level-image-lazy-loading/</a></li><li>しかし <code>loading="lazy"</code> は Safari と Internet Explorer 11 が非対応なので注意<ul><li><a href="https://caniuse.com/#feat=loading-lazy-attr" target=_blank rel=noopener>https://caniuse.com/#feat=loading-lazy-attr</a></li></ul></li></ul></li></ul><h3 id=キャッシュポリシーを適切に設定する>キャッシュポリシーを適切に設定する</h3><ul><li><a href=https://web.dev/uses-long-cache-ttl/ target=_blank rel=noopener>https://web.dev/uses-long-cache-ttl/</a></li><li>キャッシュ可能でない画像がある場合、指摘される</li><li>キャッシュ可能とみなされる条件は以下<ul><li>HTTP status code が 200, 203, 206 のいずれかである</li><li><code>Cache-Control: no-cache</code> が指定されていない</li></ul></li><li>可能ならキャッシュの有効期間を 1 年以上にすると良いというニュアンスの書き方がされている</li></ul></article><p class=back-to-top><a href=https://hacktk.net/>← Topへ</a></p></main><footer><div><picture>
<source type=image/webp srcset=https://hacktk.net/images/profile.webp><img src=https://hacktk.net/images/profile.png width=64 height=64 alt=hacktk></picture><p>Twitter: <a href=https://twitter.com/hacktk title=hacktk target=_blank rel=noopener>hacktk</a></p></div></footer></div></body></html>