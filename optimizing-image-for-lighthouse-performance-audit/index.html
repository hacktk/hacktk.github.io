<!doctype html><html lang=ja><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><title>Lighthouse の Performance audits の対応方法を調べた（画像関連のみ） | hacktk blog</title><link rel=stylesheet href=https://hacktk.net/css/sanitize.css><link rel=stylesheet href=https://hacktk.net/css/responsive.css><link rel=stylesheet href=https://hacktk.net/css/theme.css><link rel=icon href=https://hacktk.net/images/favicon.ico><link rel=canonical href=https://hacktk.net/optimizing-image-for-lighthouse-performance-audit/><link rel=alternate href=https://hacktk.net/index.xml type=application/rss+xml title="hacktk blog"><meta name=description content="Lighthouse の Performance audits で画像関連がよく指摘され、都度調べているのでメモしておく。"><meta property="og:title" content="Lighthouse の Performance audits の対応方法を調べた（画像関連のみ）"><meta property="og:description" content="Lighthouse の Performance audits で画像関連がよく指摘され、都度調べているのでメモしておく。"><meta property="og:type" content="article"><meta property="og:url" content="https://hacktk.net/optimizing-image-for-lighthouse-performance-audit/"><meta property="og:image" content="https://hacktk.net/images/profile.png"><meta property="article:published_time" content="2020-12-12T15:00:00+09:00"><meta property="article:modified_time" content="2020-12-12T15:00:00+09:00"><meta name=twitter:title content="Lighthouse の Performance audits の対応方法を調べた（画像関連のみ）"><meta name=twitter:description content="Lighthouse の Performance audits で画像関連がよく指摘され、都度調べているのでメモしておく。"><meta name=twitter:card content="summary"><meta name=twitter:image content="https://hacktk.net/images/profile.png"><meta name=google-site-verification content="iDFH4SmPeQqgvrQawVuuBPxcQc6A3uAYf1Qwcb8IqX8"></head><body><div class=container><header><div class="row gutters"><div class=col><h1><a href=https://hacktk.net/>hacktk blog</a></h1></div></div></header><main><div class=article-header><h1>Lighthouse の Performance audits の対応方法を調べた（画像関連のみ）</h1><div class="meta gray">2020-12-12</div></div><article><h2 id=前提>前提</h2><ul><li>Lighthouse の <a href=https://web.dev/lighthouse-performance/ target=_blank rel=noopener>Performance audits</a>
の中で、画像関連のものの意味や対応方法を調べた<ul><li><a href=https://web.dev/optimize-cls/#modern-best-practice target=_blank rel=noopener>Optimize Cumulative Layout Shift の Modern best practice</a>
は Lighthouse でチェックされるが、今回は上記のリストのみを調査対象とした</li></ul></li><li>各ブラウザの対応状況などは、2020 年 12 月時点のもの</li><li>ちなみに Lighthouse のスコア計算に使われるのは Metrics のみである<ul><li><a href=https://web.dev/performance-scoring/ target=_blank rel=noopener>https://web.dev/performance-scoring/</a></li><li>ただ Opportunities や Diagnostics を改善すると結果的に Metrics も改善されるので、対応するのが良い</li></ul></li></ul><h2 id=対応>対応</h2><h3 id=次世代フォーマットを使う>次世代フォーマットを使う</h3><ul><li><a href=https://web.dev/uses-webp-images/ target=_blank rel=noopener>https://web.dev/uses-webp-images/</a></li><li>次世代フォーマットは画像の圧縮率が高い</li><li>JPEG や PNG ではなく Webp などにする</li><li>Webp は 2020 年 9 月に Safari, iOS Safari が対応したので、現在の非対応は実質 Internet Explorer 11 のみ<ul><li><a href="https://caniuse.com/#feat=webp" target=_blank rel=noopener>https://caniuse.com/#feat=webp</a></li><li>※ ただし Safari は macOS 11 Big Sur 以降が必要</li></ul></li></ul><h3 id=適切な大きさにする>適切な大きさにする</h3><ul><li><a href=https://web.dev/uses-responsive-images/ target=_blank rel=noopener>https://web.dev/uses-responsive-images/</a></li><li>実際のレンダリングサイズが、画像のサイズより一定以上小さい場合に指摘される<ul><li>例：100×100 の画像を 50×50 で表示している場合</li></ul></li><li>複数の画像を用意する、画像特化の CDN を使って複数のサイズを生成する、SVG を使うなどの対応方法がある</li></ul><h3 id=画像の品質を最適化する>画像の品質を最適化する</h3><ul><li><a href=https://web.dev/uses-optimized-images/ target=_blank rel=noopener>https://web.dev/uses-optimized-images/</a></li><li>JPEG や BMP には 1〜100 の圧縮レベルがあるが、85 を最適としている<ul><li>圧縮レベル 85 にしたものと元のものを比較し、4kib 以上の差がある場合に指摘される</li></ul></li><li><a href=https://squoosh.app/ target=_blank rel=noopener>Squoosh</a>
などを使い、品質を 85 にする</li></ul><h3 id=ファーストビューに入っていない画像は読み込みを遅延させる>ファーストビューに入っていない画像は読み込みを遅延させる</h3><ul><li><a href=https://web.dev/offscreen-images/ target=_blank rel=noopener>https://web.dev/offscreen-images/</a></li><li>いわゆる Lazy load で対応する</li><li>現在は JavaScript でやっているサイトが多いが、img タグの <code>loading="lazy"</code> でもできる<ul><li><a href=https://web.dev/browser-level-image-lazy-loading/ target=_blank rel=noopener>https://web.dev/browser-level-image-lazy-loading/</a></li><li>しかし <code>loading="lazy"</code> は Safari と Internet Explorer 11 が非対応なので注意<ul><li><a href="https://caniuse.com/#feat=loading-lazy-attr" target=_blank rel=noopener>https://caniuse.com/#feat=loading-lazy-attr</a></li></ul></li></ul></li></ul><h3 id=キャッシュポリシーを適切に設定する>キャッシュポリシーを適切に設定する</h3><ul><li><a href=https://web.dev/uses-long-cache-ttl/ target=_blank rel=noopener>https://web.dev/uses-long-cache-ttl/</a></li><li>キャッシュ可能でない画像がある場合、指摘される</li><li>キャッシュ可能とみなされる条件は以下<ul><li>HTTP status code が 200, 203, 206 のいずれかである</li><li><code>Cache-Control: no-cache</code> が指定されていない</li></ul></li><li>可能ならキャッシュの有効期間を 1 年以上にすると良いというニュアンスの書き方がされている</li></ul></article><p class=back-to-top><a href=https://hacktk.net/>← Topへ</a></p></main><footer><div><picture>
<source type=image/webp srcset=https://hacktk.net/images/profile.webp><img src=https://hacktk.net/images/profile.png width=64 height=64 alt=hacktk></picture><p>Twitter: <a href=https://twitter.com/hacktk title=hacktk target=_blank rel=noopener>hacktk</a></p></div></footer></div></body></html>